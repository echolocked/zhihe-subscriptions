(()=>{var o={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return o.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)o.o(s,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t),r:o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}},t={};(()=>{"use strict";o.r(t),o.d(t,{extend:()=>V});const s=flarum.reg.get("core","common/extend"),n=flarum.reg.get("core","forum/app");var r=o.n(n);flarum.reg.get("core","common/Model");const e=flarum.reg.get("core","common/models/Discussion");var i=o.n(e);const a=flarum.reg.get("core","forum/components/NotificationGrid");var l=o.n(a);const c=flarum.reg.get("core","common/components/Badge");var u=o.n(c);const f=flarum.reg.get("core","common/components/Button");var p=o.n(f);const b=flarum.reg.get("core","forum/components/DiscussionPage");var g=o.n(b);const d=flarum.reg.get("core","forum/utils/DiscussionControls");var _=o.n(d);const w=flarum.reg.get("core","common/components/Dropdown");var h=o.n(w);const v=flarum.reg.get("core","common/components/Tooltip");var y=o.n(v);const x=flarum.reg.get("core","common/helpers/icon");var S=o.n(x);const P=flarum.reg.get("core","common/utils/extractText");var N=o.n(P);const M=flarum.reg.get("core","common/utils/classList");var k=o.n(M);const B=flarum.reg.get("core","common/Component");var D=o.n(B);class I extends(D()){view(){return m("button",{className:"SubscriptionMenuItem hasIcon",onclick:this.attrs.onclick},this.attrs.active&&S()("fas fa-check",{className:"Button-icon"}),m("span",{className:"SubscriptionMenuItem-label"},S()(this.attrs.icon,{className:"Button-icon"}),m("strong",null,this.attrs.label),m("span",{className:"SubscriptionMenuItem-description"},this.attrs.description)))}}flarum.reg.add("flarum-subscriptions","forum/components/SubscriptionMenuItem",I);class A extends(h()){oninit(o){super.oninit(o),this.options=[{subscription:null,icon:"far fa-star",label:r().translator.trans("flarum-subscriptions.forum.sub_controls.not_following_button"),description:r().translator.trans("flarum-subscriptions.forum.sub_controls.not_following_text")},{subscription:"follow",icon:"fas fa-star",label:r().translator.trans("flarum-subscriptions.forum.sub_controls.following_button"),description:r().translator.trans("flarum-subscriptions.forum.sub_controls.following_text")},{subscription:"ignore",icon:"far fa-eye-slash",label:r().translator.trans("flarum-subscriptions.forum.sub_controls.ignoring_button"),description:r().translator.trans("flarum-subscriptions.forum.sub_controls.ignoring_text")}]}view(){const o=this.attrs.discussion,t=o.subscription();let s=r().translator.trans("flarum-subscriptions.forum.sub_controls.follow_button"),n="far fa-star";const e="SubscriptionMenu-button--"+t;switch(t){case"follow":s=r().translator.trans("flarum-subscriptions.forum.sub_controls.following_button"),n="fas fa-star";break;case"ignore":s=r().translator.trans("flarum-subscriptions.forum.sub_controls.ignoring_button"),n="far fa-eye-slash"}const i=r().session.user.preferences(),a=i.notify_newPost_email,l=i.notify_newPost_alert,c=N()(r().translator.trans(a?"flarum-subscriptions.forum.sub_controls.notify_email_tooltip":"flarum-subscriptions.forum.sub_controls.notify_alert_tooltip")),u=(a||l)&&null===t,f=m(p(),{className:k()("Button","SubscriptionMenu-button",e),icon:n,onclick:this.saveSubscription.bind(this,o,-1!==["follow","ignore"].indexOf(t)?null:"follow")},s);return m("div",{className:"Dropdown ButtonGroup SubscriptionMenu"},u?m(y(),{text:c,position:"bottom"},f):f,m("button",{className:k()("Dropdown-toggle Button Button--icon",e),"data-toggle":"dropdown"},S()("fas fa-caret-down",{className:"Button-icon"})),m("ul",{className:"Dropdown-menu dropdown-menu Dropdown-menu--right"},this.options.map((s=>m("li",null,m(I,Object.assign({},s,{onclick:this.saveSubscription.bind(this,o,s.subscription),active:t===s.subscription})))))))}saveSubscription(o,t){o.save({subscription:t}),this.$(".SubscriptionMenu-button").tooltip("hide")}}flarum.reg.add("flarum-subscriptions","forum/components/SubscriptionMenu",A);const O=flarum.reg.get("core","common/components/LinkButton");var R=o.n(O);const T=flarum.reg.get("core","forum/components/IndexPage");var j=o.n(T);const L=flarum.reg.get("core","forum/states/DiscussionListState");var C=o.n(L);const q=flarum.reg.get("core","forum/states/GlobalSearchState");var F=o.n(q);const G=flarum.reg.get("core","forum/components/SettingsPage");var z=o.n(G);const U=flarum.reg.get("core","common/components/Switch");var $=o.n(U);const E=flarum.reg.get("core","forum/components/Notification");var H=o.n(E);class J extends(H()){icon(){return"fas fa-star"}href(){const o=this.attrs.notification,t=o.subject(),s=o.content()||{};return r().route.discussion(t,s.postNumber)}content(){return r().translator.trans("flarum-subscriptions.forum.notifications.new_post_text",{user:this.attrs.notification.fromUser()})}}flarum.reg.add("flarum-subscriptions","forum/components/NewPostNotification",J);const K=flarum.reg.get("core","common/extenders");var Q=o.n(K);const V=[(new(Q().Routes)).add("following","/following",j()),new(Q().Model)(i()).attribute("subscription")];r().initializers.add("subscriptions",(function(){r().notificationComponents.newPost=J,(0,s.extend)(i().prototype,"badges",(function(o){let t;switch(this.subscription()){case"follow":t=m(u(),{label:r().translator.trans("flarum-subscriptions.forum.badge.following_tooltip"),icon:"fas fa-star",type:"following"});break;case"ignore":t=m(u(),{label:r().translator.trans("flarum-subscriptions.forum.badge.ignoring_tooltip"),icon:"far fa-eye-slash",type:"ignoring"})}t&&o.add("subscription",t)})),(0,s.extend)(_(),"userControls",(function(o,t,s){if(r().session.user&&!(s instanceof g())){const s={none:{label:r().translator.trans("flarum-subscriptions.forum.discussion_controls.follow_button"),icon:"fas fa-star",save:"follow"},follow:{label:r().translator.trans("flarum-subscriptions.forum.discussion_controls.unfollow_button"),icon:"far fa-star",save:null},ignore:{label:r().translator.trans("flarum-subscriptions.forum.discussion_controls.unignore_button"),icon:"fas fa-eye",save:null}},n=t.subscription()||"none";o.add("subscription",m(p(),{icon:s[n].icon,onclick:t.save.bind(t,{subscription:s[n].save})},s[n].label))}})),(0,s.extend)(g().prototype,"sidebarItems",(function(o){if(r().session.user){const t=this.discussion;o.add("subscription",m(A,{discussion:t}),80)}})),(0,s.extend)(j().prototype,"navItems",(function(o){if(r().session.user){const t=r().search.stickyParams();o.add("following",m(R(),{href:r().route("following",t),icon:"fas fa-star"},r().translator.trans("flarum-subscriptions.forum.index.following_link")),50)}})),(0,s.extend)(j().prototype,"setTitle",(function(){"following"===r().current.get("routeName")&&r().setTitle(r().translator.trans("flarum-subscriptions.forum.following.meta_title_text"))})),(0,s.extend)(F().prototype,"params",(function(o){o.onFollowing="following"===r().current.get("routeName")})),(0,s.extend)(C().prototype,"requestParams",(function(o){this.params.onFollowing&&(o.filter||(o.filter={}),o.filter.q?o.filter.q+=" is:following":o.filter.subscription="following")})),(0,s.extend)(z().prototype,"notificationsItems",(function(o){var t;o.add("followAfterReply",m($(),{state:this.user.preferences().followAfterReply,onchange:o=>{this.followAfterReplyLoading=!0,this.user.savePreferences({followAfterReply:o}).then((()=>{this.followAfterReplyLoading=!1,m.redraw()}))},loading:this.followAfterReplyLoading},r().translator.trans("flarum-subscriptions.forum.settings.follow_after_reply_label"))),o.add("notifyForAllPosts",m($(),{id:"flarum_subscriptions__notify_for_all_posts",state:!(null==(t=this.user.preferences())||!t["flarum-subscriptions.notify_for_all_posts"]),onchange:o=>{this.user.savePreferences({"flarum-subscriptions.notify_for_all_posts":o})}},r().translator.trans("flarum-subscriptions.forum.settings.notify_for_all_posts_label")))})),(0,s.extend)(l().prototype,"notificationTypes",(function(o){o.add("newPost",{name:"newPost",icon:"fas fa-star",label:r().translator.trans("flarum-subscriptions.forum.settings.notify_new_post_label")})}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map